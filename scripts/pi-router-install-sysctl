#!/bin/bash
#
# Pi Router - Helper script to install sysctl configuration
# This script is called via sudo by the web application
#

set -e

# Check arguments
if [ $# -lt 1 ]; then
    echo "Usage: $0 <temp_config_file>"
    exit 1
fi

TEMP_FILE="$1"
TARGET_FILE="/etc/sysctl.d/99-pi-router-forwarding.conf"

# Validate temp file exists
if [ ! -f "$TEMP_FILE" ]; then
    echo "Error: Temp file not found: $TEMP_FILE"
    exit 1
fi

# Move new config to target
mv "$TEMP_FILE" "$TARGET_FILE"

# Set proper permissions
chmod 644 "$TARGET_FILE"
chown root:root "$TARGET_FILE"

# Apply sysctl settings
sysctl -p "$TARGET_FILE" > /dev/null 2>&1 || true

echo "sysctl configuration installed successfully"
