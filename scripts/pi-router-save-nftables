#!/bin/bash
#
# Pi Router - Helper script to save nftables configuration
# This script is called via sudo by the web application
#

set -e

# Check arguments
if [ $# -lt 1 ]; then
    echo "Usage: $0 <config_file>"
    exit 1
fi

CONFIG_FILE="$1"
TARGET_DIR="/etc/nftables.d"
TARGET_FILE="$TARGET_DIR/pi-router.nft"

# Validate config file exists
if [ ! -f "$CONFIG_FILE" ]; then
    echo "Error: Config file not found: $CONFIG_FILE"
    exit 1
fi

# Create directory if it doesn't exist
mkdir -p "$TARGET_DIR"

# Copy config to target
cp "$CONFIG_FILE" "$TARGET_FILE"

# Set proper permissions
chmod 644 "$TARGET_FILE"
chown root:root "$TARGET_FILE"

echo "nftables configuration saved successfully"
